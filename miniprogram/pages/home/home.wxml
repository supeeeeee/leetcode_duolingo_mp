<!--pages/home/home.wxml-->
<view class="container {{loading ? 'loading' : ''}}">
  <view class="header animate-fade">
    <view class="stat-box">
      <text class="emoji">🔥</text>
      <text class="stat-value">{{streak}}</text>
    </view>
    <view class="stat-box">
      <text class="emoji">💎</text>
      <text class="stat-value">{{xp}} XP</text>
    </view>
  </view>

  <view class="hero animate-pop" wx:if="{{!loading}}">
    <view class="mascot">🦉</view>
    <text class="hero-title">准备好开始今日刷题了吗？</text>
    <text class="hero-subtitle">保持你的连胜记录！</text>
  </view>

  <!-- Daily Challenge Card -->
  <view class="daily-challenge-card animate-fade" wx:if="{{!loading}}" hover-class="active-state" hover-stay-time="100" bindtap="startDailyChallenge">
    <view class="challenge-badge" wx:if="{{dailyStatus && !dailyStatus.isCompleted}}">新</view>
    <view class="challenge-icon">🎯</view>
    <view class="challenge-info">
      <text class="challenge-title">每日挑战</text>
      <text class="challenge-desc">5 道题目 • {{dailyChallengeXP}} XP</text>
    </view>
    <view class="challenge-arrow">〉</view>
  </view>

  <view class="today-suggestions animate-fade" wx:if="{{!loading}}">
    <view class="card">
      <text class="card-title">今日建议</text>
      <view class="suggestion-stats-row">
        <view class="suggestion-stat-item">
          <text class="suggestion-stat-value">{{dueCoreTotal}}</text>
          <text class="suggestion-stat-label">待做核心题</text>
        </view>
        <view class="suggestion-stat-item">
          <text class="suggestion-stat-value">{{dueCoreChapterCount}}</text>
          <text class="suggestion-stat-label">涉及章节</text>
        </view>
        <view class="suggestion-stat-item">
          <text class="suggestion-stat-value">{{wrongCount}}</text>
          <text class="suggestion-stat-label">错题待复习</text>
        </view>
      </view>

      <view wx:if="{{recommendedTopicId}}" class="recommended-topic">
        <text class="recommended-topic-title">推荐继续：{{recommendedTopicTitle}}</text>
        <text class="recommended-topic-desc">{{recommendedTopicDesc}}</text>
      </view>

      <view class="chapter-list" wx:if="{{chapterSuggestions.length > 0}}">
        <view class="chapter-item" wx:for="{{chapterSuggestions}}" wx:key="id">
          <text class="chapter-item-title">{{item.title}}</text>
          <text class="chapter-item-meta">核心待做 {{item.dueCore}} · 错题 {{item.wrong}}</text>
        </view>
      </view>

      <view class="today-cta-row">
        <button class="today-btn primary" hover-class="none" bindtap="continueRecommendedTopic">{{recommendedTopicId ? '继续推荐章节' : '前往学习路径'}}</button>
        <button class="today-btn" hover-class="none" bindtap="goPath">路径</button>
        <button class="today-btn" hover-class="none" bindtap="startDailyChallenge">每日</button>
      </view>
    </view>
  </view>

  <view class="action-area animate-fade" wx:if="{{!loading}}">
    <button class="btn" hover-class="none" bindtap="startDailyReview">开始复习</button>
  </view>

  <view class="daily-goals animate-fade" wx:if="{{!loading}}">
    <view class="card">
      <text class="card-title">今日目标</text>
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{ todayGoalPercent }}%"></view>
      </view>
      <text class="card-desc">再赚取 {{ 50 - todayXP > 0 ? 50 - todayXP : 0 }} XP 即可达成今日目标。你今天已获得 {{todayXP}} XP。</text>
    </view>
  </view>

  <!-- Loading Placeholder -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="spinner"></view>
  </view>
</view>
