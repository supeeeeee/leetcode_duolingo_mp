<!--pages/home/home.wxml-->
<view class="container {{loading ? 'loading' : ''}}">
  <view class="header animate-fade">
    <view class="stat-box">
      <text class="emoji">🔥</text>
      <text class="stat-value">{{streak}}</text>
    </view>
    <view class="stat-box">
      <text class="emoji">💎</text>
      <text class="stat-value">{{xp}} XP</text>
    </view>
  </view>

  <view class="hero animate-pop" wx:if="{{!loading}}">
    <view class="mascot">🦉</view>
    <text class="hero-title">准备好开始今日刷题了吗？</text>
    <text class="hero-subtitle">保持你的连胜记录！</text>
  </view>

  <!-- Daily Challenge Card -->
  <view class="daily-challenge-card animate-fade" wx:if="{{!loading}}" hover-class="active-state" hover-stay-time="100" bindtap="startDailyChallenge">
    <view class="challenge-badge" wx:if="{{dailyStatus && !dailyStatus.isCompleted}}">新</view>
    <view class="challenge-icon">🎯</view>
    <view class="challenge-info">
      <text class="challenge-title">每日挑战</text>
      <text class="challenge-desc">5 道题目 • {{dailyChallengeXP}} XP</text>
    </view>
    <view class="challenge-arrow">〉</view>
  </view>

  <view class="today-suggestions animate-fade" wx:if="{{!loading}}">
    <view class="card suggestion-card">
      <view class="card-header-row">
        <text class="card-title">💡 今日建议</text>
      </view>
      
      <view class="stats-pills">
        <view class="stat-pill">
          <text class="pill-num">{{dueCoreTotal}}</text>
          <text class="pill-lbl">待做核心</text>
        </view>
        <view class="stat-pill">
          <text class="pill-num">{{dueCoreChapterCount}}</text>
          <text class="pill-lbl">涉及章节</text>
        </view>
        <view class="stat-pill {{wrongCount > 0 ? 'highlight' : ''}}">
          <text class="pill-num">{{wrongCount}}</text>
          <text class="pill-lbl">错题待复习</text>
        </view>
      </view>

      <view class="divider" wx:if="{{recommendedTopicId || wrongCount > 0}}"></view>

      <view wx:if="{{recommendedTopicId}}" class="rec-section">
        <view class="rec-tag">推荐练习</view>
        <text class="rec-title">{{recommendedTopicTitle}}</text>
        <text class="rec-desc">{{recommendedTopicDesc}}</text>
      </view>

      <view wx:if="{{wrongCount > 0}}" class="wrong-review-widget" bindtap="startWrongReview" hover-class="widget-hover">
        <view class="wr-icon">🩹</view>
        <view class="wr-info">
          <text class="wr-main">错题复习</text>
          <text class="wr-sub">本次建议复习 {{wrongReviewSessionCount}} 题</text>
        </view>
        <view class="wr-arrow">👉</view>
      </view>

      <view class="chapter-list-mini" wx:if="{{chapterSuggestions.length > 0}}">
         <text class="list-label">重点关注章节</text>
         <view class="mini-item" wx:for="{{chapterSuggestions}}" wx:key="id">
            <text class="mini-title">{{item.title}}</text>
            <view class="mini-tags">
               <text wx:if="{{item.dueCore > 0}}" class="tag core">核心 {{item.dueCore}}</text>
               <text wx:if="{{item.wrong > 0}}" class="tag wrong">错题 {{item.wrong}}</text>
            </view>
         </view>
      </view>

      <view class="action-footer">
        <button class="primary-action-btn" hover-class="btn-active" bindtap="startRecommendedAction">{{recommendedActionText}}</button>
        <view class="sub-actions">
           <button class="sub-action-btn" hover-class="sub-active" bindtap="goPath">路径</button>
           <button class="sub-action-btn" hover-class="sub-active" bindtap="startDailyChallenge">每日</button>
        </view>
      </view>
    </view>
  </view>

  <view class="action-area animate-fade" wx:if="{{!loading}}">
    <view class="action-row">
      <button class="btn" hover-class="none" bindtap="startDailyReview">开始复习</button>
      <button class="btn secondary" hover-class="none" bindtap="startWrongReview">错题复习</button>
    </view>
  </view>

  <view class="daily-goals animate-fade" wx:if="{{!loading}}">
    <view class="card">
      <text class="card-title">今日目标</text>
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{ todayGoalPercent }}%"></view>
      </view>
      <text class="card-desc">再赚取 {{ 50 - todayXP > 0 ? 50 - todayXP : 0 }} XP 即可达成今日目标。你今天已获得 {{todayXP}} XP。</text>
    </view>
  </view>

  <!-- Loading Placeholder -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="spinner"></view>
  </view>
</view>
