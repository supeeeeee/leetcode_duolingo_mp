<!--pages/home/home.wxml-->
<view class="container {{loading ? 'loading' : ''}}">
  <view class="header animate-fade">
    <view class="stat-box">
      <text class="emoji">ğŸ”¥</text>
      <text class="stat-value">{{streak}}</text>
    </view>
    <view class="stat-box">
      <text class="emoji">ğŸ’</text>
      <text class="stat-value">{{xp}} XP</text>
    </view>
  </view>

  <view class="hero animate-pop" wx:if="{{!loading}}">
    <view class="mascot">ğŸ¦‰</view>
    <text class="hero-title">å‡†å¤‡å¥½å¼€å§‹ä»Šæ—¥åˆ·é¢˜äº†å—ï¼Ÿ</text>
    <text class="hero-subtitle">ä¿æŒä½ çš„è¿èƒœè®°å½•ï¼</text>
  </view>

  <!-- Daily Challenge Card -->
  <view class="daily-challenge-card animate-fade" wx:if="{{!loading}}" hover-class="active-state" hover-stay-time="100" bindtap="startDailyChallenge">
    <view class="challenge-badge" wx:if="{{dailyStatus && !dailyStatus.isCompleted}}">æ–°</view>
    <view class="challenge-icon">ğŸ¯</view>
    <view class="challenge-info">
      <text class="challenge-title">æ¯æ—¥æŒ‘æˆ˜</text>
      <text class="challenge-desc">5 é“é¢˜ç›® â€¢ {{dailyChallengeXP}} XP</text>
    </view>
    <view class="challenge-arrow">ã€‰</view>
  </view>

  <view class="today-suggestions animate-fade" wx:if="{{!loading}}">
    <view class="card">
      <text class="card-title">ä»Šæ—¥å»ºè®®</text>
      <view class="suggestion-stats-row">
        <view class="suggestion-stat-item">
          <text class="suggestion-stat-value">{{dueCoreTotal}}</text>
          <text class="suggestion-stat-label">å¾…åšæ ¸å¿ƒé¢˜</text>
        </view>
        <view class="suggestion-stat-item">
          <text class="suggestion-stat-value">{{dueCoreChapterCount}}</text>
          <text class="suggestion-stat-label">æ¶‰åŠç« èŠ‚</text>
        </view>
        <view class="suggestion-stat-item">
          <text class="suggestion-stat-value">{{wrongCount}}</text>
          <text class="suggestion-stat-label">é”™é¢˜å¾…å¤ä¹ </text>
        </view>
      </view>

      <view wx:if="{{recommendedTopicId}}" class="recommended-topic">
        <text class="recommended-topic-title">æ¨èç»§ç»­ï¼š{{recommendedTopicTitle}}</text>
        <text class="recommended-topic-desc">{{recommendedTopicDesc}}</text>
      </view>

      <view class="chapter-list" wx:if="{{chapterSuggestions.length > 0}}">
        <view class="chapter-item" wx:for="{{chapterSuggestions}}" wx:key="id">
          <text class="chapter-item-title">{{item.title}}</text>
          <text class="chapter-item-meta">æ ¸å¿ƒå¾…åš {{item.dueCore}} Â· é”™é¢˜ {{item.wrong}}</text>
        </view>
      </view>

      <view class="today-cta-row">
        <button class="today-btn primary" hover-class="none" bindtap="startRecommendedAction">{{recommendedActionText}}</button>
        <button class="today-btn" hover-class="none" bindtap="goPath">è·¯å¾„</button>
        <button class="today-btn" hover-class="none" bindtap="startDailyChallenge">æ¯æ—¥</button>
      </view>
    </view>
  </view>

  <view class="action-area animate-fade" wx:if="{{!loading}}">
    <view class="action-row">
      <button class="btn" hover-class="none" bindtap="startDailyReview">å¼€å§‹å¤ä¹ </button>
      <button class="btn secondary" hover-class="none" bindtap="startWrongReview">é”™é¢˜å¤ä¹ </button>
    </view>
  </view>

  <view class="daily-goals animate-fade" wx:if="{{!loading}}">
    <view class="card">
      <text class="card-title">ä»Šæ—¥ç›®æ ‡</text>
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{ todayGoalPercent }}%"></view>
      </view>
      <text class="card-desc">å†èµšå– {{ 50 - todayXP > 0 ? 50 - todayXP : 0 }} XP å³å¯è¾¾æˆä»Šæ—¥ç›®æ ‡ã€‚ä½ ä»Šå¤©å·²è·å¾— {{todayXP}} XPã€‚</text>
    </view>
  </view>

  <!-- Loading Placeholder -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="spinner"></view>
  </view>
</view>
