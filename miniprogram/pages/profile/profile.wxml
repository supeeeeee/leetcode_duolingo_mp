<!--pages/profile/profile.wxml-->
<view class="container animate-fade">
  
  <!-- Profile Header Card -->
  <view class="header-section">
    <view class="profile-header-card">
      <view class="profile-content">
        <view class="avatar-container">
          <view class="avatar-ring">
            <text class="avatar-emoji">ğŸ‘¨â€ğŸ’»</text>
          </view>
          <view class="level-pill">Lv.{{userLevel}}</view>
        </view>
        
        <view class="user-details">
          <view class="name-row">
            <text class="username">åŠ›æ‰£æ¢ç´¢è€…</text>
            <button class="share-btn" open-type="share">
              <text class="share-icon">ğŸ“¤</text>
            </button>
          </view>
          <text class="join-date">2026å¹´2æœˆåŠ å…¥</text>
        </view>
      </view>

      <!-- XP Progress -->
      <view class="xp-container">
        <view class="xp-info">
          <text class="xp-label">ç­‰çº§ {{userLevel}}</text>
          <text class="xp-value">{{xpProgress}}/100 XP</text>
        </view>
        <view class="progress-track">
          <view class="progress-fill" style="width: {{xpProgress}}%"></view>
        </view>
        <text class="xp-next-tip" wx:if="{{xpToNext > 0}}">å†è·å¾— {{xpToNext}} XP å‡çº§</text>
      </view>
    </view>
  </view>

  <!-- Stats Grid -->
  <view class="section-container">
    <text class="section-title">ç»Ÿè®¡æ•°æ®</text>
    <view class="stats-grid">
      <view class="stat-card streak-card">
        <text class="stat-icon">ğŸ”¥</text>
        <view class="stat-text">
          <text class="stat-num">{{streak}}</text>
          <text class="stat-lbl">è¿ç»­å¤©æ•°</text>
        </view>
      </view>
      <view class="stat-card xp-card">
        <text class="stat-icon">ğŸ’</text>
        <view class="stat-text">
          <text class="stat-num">{{xp}}</text>
          <text class="stat-lbl">æ€»ç»éªŒå€¼</text>
        </view>
      </view>
      <view class="stat-card total-card">
        <text class="stat-icon">ğŸ“š</text>
        <view class="stat-text">
          <text class="stat-num">{{totalAnswered}}</text>
          <text class="stat-lbl">å·²è§£é¢˜æ•°</text>
        </view>
      </view>
      <view class="stat-card accuracy-card">
        <text class="stat-icon">ğŸ¯</text>
        <view class="stat-text">
          <text class="stat-num">{{accuracy}}%</text>
          <text class="stat-lbl">æ­£ç¡®ç‡</text>
        </view>
      </view>
    </view>
  </view>

  <!-- Review Section -->
  <view class="section-container">
    <text class="section-title">å¤ä¹ ä»»åŠ¡</text>
    <view class="review-card {{wrongCount > 0 ? 'active-review' : 'empty-review'}}" bindtap="startWrongReview" hover-class="card-hover">
      <view class="review-icon-box">
        <text class="review-emoji">ğŸ©¹</text>
      </view>
      <view class="review-info">
        <text class="review-title">é”™é¢˜æœ¬å¤ä¹ </text>
        <view class="review-meta">
          <text class="review-badge" wx:if="{{wrongCount > 0}}">{{wrongCount}} å¾…å¤ä¹ </text>
          <text class="review-desc" wx:else>æš‚æ— é”™é¢˜ï¼Œç»§ç»­ä¿æŒï¼</text>
        </view>
      </view>
      <view class="review-arrow" wx:if="{{wrongCount > 0}}">GO</view>
    </view>
  </view>

  <!-- Weekly Activity -->
  <view class="section-container">
    <view class="section-header">
      <text class="section-title">æœ¬å‘¨æ´»è·ƒ</text>
    </view>
    <view class="card chart-card">
      <view class="chart-area">
        <view class="chart-column" wx:for="{{weekDays}}" wx:key="day">
          <view class="bar-wrapper">
            <view class="bar-fill {{item.active ? 'active' : ''}}" style="height: {{item.count > 0 ? (item.count * 15 + 10) : 0}}rpx"></view>
          </view>
          <text class="day-text">{{item.day}}</text>
        </view>
      </view>
      <view class="chart-footer">
        <text class="chart-stat">å•æ—¥æœ€é«˜: {{bestCount}} é¢˜</text>
      </view>
    </view>
  </view>

  <!-- Achievements -->
  <view class="section-container last-section">
    <view class="section-header">
      <text class="section-title">æˆå°±å¥–åŠ±</text>
      <!-- <view class="view-all">å…¨éƒ¨</view> -->
    </view>

    <scroll-view class="achievements-scroll" scroll-x enable-flex>
      <view 
        class="achievement-item {{item.unlocked ? 'unlocked' : 'locked'}}" 
        wx:for="{{achievements}}" 
        wx:key="id"
        bindtap="showAchievement"
        data-id="{{item.id}}"
        hover-class="achievement-hover"
      >
        <view class="achievement-icon-box">
          <text class="achievement-emoji">{{item.icon}}</text>
          <view class="lock-overlay" wx:if="{{!item.unlocked}}">
            <text class="lock-icon">ğŸ”’</text>
          </view>
        </view>
        <text class="achievement-name">{{item.name}}</text>
      </view>
      <!-- Padding item for scroll -->
      <view class="scroll-padding"></view>
    </scroll-view>
  </view>

  <!-- Achievement Detail Modal -->
  <view class="modal-mask animate-fade" wx:if="{{showAchievementDetail}}" bindtap="hideAchievement">
    <view class="modal-content animate-pop" catchtap="stopBubbling">
      <view class="modal-header">
        <text class="modal-icon">{{selectedAchievement.icon}}</text>
      </view>
      <text class="modal-title">{{selectedAchievement.name}}</text>
      <text class="modal-desc">{{selectedAchievement.description}}</text>
      <view class="modal-status {{selectedAchievement.unlocked ? 'status-unlocked' : 'status-locked'}}">
        {{selectedAchievement.unlocked ? 'âœ¨ å·²è§£é”' : 'ğŸ”’ æœªè§£é”'}}
      </view>
      <button class="modal-btn" bindtap="hideAchievement">å¤ªæ£’äº†</button>
    </view>
  </view>
</view>
