<!--pages/profile/profile.wxml-->
<view class="container">
  <!-- Profile Header -->
  <view class="profile-card">
    <view class="profile-main">
      <view class="avatar-box">
        <view class="avatar-ring">
          <text class="avatar-emoji">ğŸ‘¨â€ğŸ’»</text>
        </view>
        <view class="level-badge">Lv.{{userLevel}}</view>
      </view>
      
      <view class="user-info">
        <view class="name-row">
          <text class="username">åŠ›æ‰£æ¢ç´¢è€…</text>
          <button class="share-btn" open-type="share">
            <text class="share-icon">ğŸ“¤</text>
          </button>
        </view>
        <text class="join-date">2026å¹´2æœˆåŠ å…¥</text>
      </view>
    </view>

    <!-- XP Progress integrated into header card -->
    <view class="xp-section">
      <view class="xp-header">
        <text class="xp-title">ç­‰çº§ {{userLevel}}</text>
        <text class="xp-detail">{{xpProgress}}/100 XP</text>
      </view>
      <view class="progress-track">
        <view class="progress-fill" style="width: {{xpProgress}}%"></view>
      </view>
      <text class="xp-tip" wx:if="{{xpToNext > 0}}">è¿˜å·® {{xpToNext}} XP å‡è‡³ç­‰çº§ {{userLevel + 1}}</text>
    </view>
  </view>

  <!-- Stats Grid -->
  <view class="section-container">
    <view class="section-header">
      <text class="section-title">ç»Ÿè®¡æ•°æ®</text>
    </view>
    
    <view class="stats-grid">
      <view class="stat-item streak-card">
        <view class="stat-icon">ğŸ”¥</view>
        <view class="stat-info">
          <text class="stat-value">{{streak}}</text>
          <text class="stat-label">è¿ç»­å¤©æ•°</text>
        </view>
      </view>
      <view class="stat-item questions-card">
        <view class="stat-icon">ğŸ“š</view>
        <view class="stat-info">
          <text class="stat-value">{{totalAnswered}}</text>
          <text class="stat-label">å·²è§£é¢˜æ•°</text>
        </view>
      </view>
      <view class="stat-item accuracy-card">
        <view class="stat-icon">ğŸ¯</view>
        <view class="stat-info">
          <text class="stat-value">{{accuracy}}%</text>
          <text class="stat-label">æ­£ç¡®ç‡</text>
        </view>
      </view>
      <view class="stat-item xp-total-card">
        <view class="stat-icon">ğŸ’</view>
        <view class="stat-info">
          <text class="stat-value">{{xp}}</text>
          <text class="stat-label">æ€»ç»éªŒå€¼</text>
        </view>
      </view>
    </view>
  </view>

  <view class="section-container">
    <view class="section-header">
      <text class="section-title">å¤ä¹ å…¥å£</text>
      <view class="review-entry-meta">
        <text class="section-subtitle {{wrongCount > 0 ? 'has-wrong' : ''}}">å¾…å¤ä¹  {{wrongCount}} é¢˜</text>
        <text class="review-entry-remain">é”™é¢˜æœ¬å‰©ä½™ {{wrongCount}}</text>
      </view>
    </view>
    <button class="review-btn" bindtap="startWrongReview">é”™é¢˜å¤ä¹ </button>
  </view>

  <!-- Weekly Activity -->
  <view class="section-container">
    <view class="section-header">
      <text class="section-title">æœ¬å‘¨æ´»è·ƒ</text>
      <text class="section-subtitle">æœ€é«˜: {{bestCount}} é¢˜</text>
    </view>

    
    <view class="activity-box">
      <view class="chart-area">
        <view class="chart-column" wx:for="{{weekDays}}" wx:key="day">
          <view class="bar-wrapper">
            <view class="bar-fill {{item.active ? 'active' : ''}}" style="height: {{item.count > 0 ? (item.count * 15 + 10) : 0}}rpx"></view>
          </view>
          <text class="day-text">{{item.day}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- Achievements -->
  <view class="section-container">
    <view class="section-header">
      <text class="section-title">æˆå°±å¥–åŠ±</text>
      <view class="view-all">æŸ¥çœ‹å…¨éƒ¨</view>
    </view>

    
    <scroll-view class="achievements-scroll" scroll-x enable-flex>
      <view 
        class="badge-item {{item.unlocked ? 'unlocked' : 'locked'}}" 
        wx:for="{{achievements}}" 
        wx:key="id"
        bindtap="showAchievement"
        data-id="{{item.id}}"
      >
        <view class="badge-icon">{{item.icon}}</view>
        <text class="badge-name">{{item.name}}</text>
        <view class="lock-overlay" wx:if="{{!item.unlocked}}">
          <text class="lock-icon">ğŸ”’</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- Achievement Detail Modal -->
  <view class="modal-mask" wx:if="{{showAchievementDetail}}" bindtap="hideAchievement">
    <view class="modal-content" catchtap="stopBubbling">
      <view class="modal-icon">{{selectedAchievement.icon}}</view>
      <text class="modal-title">{{selectedAchievement.name}}</text>
      <text class="modal-desc">{{selectedAchievement.description}}</text>
      <view class="modal-status {{selectedAchievement.unlocked ? 'status-unlocked' : 'status-locked'}}">
        {{selectedAchievement.unlocked ? 'å·²è§£é”ï¼' : 'ç»§ç»­ç»ƒä¹ ä»¥è§£é”'}}
      </view>
      <button class="modal-close" bindtap="hideAchievement">çŸ¥é“äº†ï¼</button>
    </view>
  </view>
</view>
